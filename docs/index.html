<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>6502 Emulator Dashboard</title>
    <link rel="stylesheet" href="./style.css" />
  </head>

  <body>
    <header class="topbar">
      <div>
        <h1>6502 Emulator</h1>
        <p class="sub">JS/CSS/HTML GUI for rustiNESs 6502 emulator written in Rust based on javidx9's wonderful video</p>
      </div>

      <div class="status">
        <span class="dot" id="statusDot"></span>
        <span id="statusText">Loading WASM…</span>
      </div>
    </header>

    <main class="grid">
      <!-- Assembler -->
      <section class="card">
        <h2>Program code</h2>
        <textarea id="asmInput" spellcheck="false">
A9 42
8D 00 02
4C 00 80
        </textarea>

        <div class="row">
          <button id="btnAssemble" class="primary">Load</button>
          <button id="btnReset">Reset</button>
        </div>
      </section>

      <!-- Controls -->
      <section class="card">
        <h2>Controls</h2>

        <div class="controls">
          <button id="btnStep" class="primary">Step Instruction</button>
          <button id="btnClock">Clock (1 cycle)</button>
        </div>

        <div class="log" id="log"></div>
      </section>

      <!-- Registers -->
      <section class="card">
        <h2>CPU status</h2>

        <div class="kv">
            <div class="k">A</div><div class="v" id="a">--</div>
            <div class="k">X</div><div class="v" id="x">--</div>
            <div class="k">Y</div><div class="v" id="y">--</div>
            <div class="k">PC</div><div class="v" id="pc">----</div>
            <div class="k">SP</div><div class="v" id="sp">--</div>
            <div class="k">STATUS</div><div class="v" id="status">--------</div>

            <hr style="grid-column: 1 / -1; opacity: 0.2; margin: 10px 0;">

            <div class="k">FETCHED</div><div class="v" id="fetched">--</div>
            <div class="k">ADDR_ABS</div><div class="v" id="addr_abs">----</div>
            <div class="k">ADDR_REL</div><div class="v" id="addr_rel">----</div>
            <div class="k">OPCODE</div><div class="v" id="opcode">--</div>
            <div class="k">CYCLES</div><div class="v" id="cycles">----</div>

        </div>
      </section>

  <!-- RAM + Beginner Panel -->
  <section class="card wide">
    <h2>RAM</h2>

    <div class="ram-wrap">
      <div class="ram-scroll" aria-label="RAM scroll">
        <div class="ram" id="ramGrid"></div>
      </div>


      <aside class="learn" aria-label="Beginner explanation">
        <h3>What the 6502 is doing</h3>

        <p>
          The 6502 is a tiny CPU. It repeatedly:
          <strong>fetches</strong> a byte from memory (an instruction),
          <strong>decodes</strong> what it means, then <strong>executes</strong> it.
        </p>

        <div class="learn-block">
          <h4>Key ideas</h4>
          <ul>
            <li><strong>RAM</strong> is just a big list of bytes (00–FF) at addresses (0000–FFFF).</li>
            <li><strong>PC</strong> (Program Counter) is “where the next instruction lives.”</li>
            <li><strong>A</strong> is the main working register (“the CPU’s hand”).</li>
            <li><strong>Fetch → Decode → Execute</strong> happens over several <strong>cycles</strong>.</li>
          </ul>
        </div>

        <div class="learn-block">
          <h4>This demo program</h4>
          <ol>
            <li><code>A9 42</code> = <strong>LDA #$42</strong> → put 42 into <strong>A</strong></li>
            <li><code>8D 00 02</code> = <strong>STA $0200</strong> → write <strong>A</strong> into RAM at <code>$0200</code></li>
            <li><code>4C 00 80</code> = <strong>JMP $8000</strong> → set <strong>PC</strong> back to <code>$8000</code> (loop)</li>
          </ol>
          <p class="muted">
            Result: RAM at <code>$0200</code> becomes <code>42</code> and stays that way, while the PC loops forever.
          </p>
        </div>

        <div class="learn-block">
          <h4>What to watch in the panel in the upper right?</h4>
          <ul>
            <li><strong>PC highlight</strong> shows where the CPU is reading next.</li>
            <li><strong>OPCODE</strong> shows the current instruction byte (like A9 / 8D / 4C).</li>
            <li><strong>ADDR_ABS</strong> shows the computed memory address (like 0200).</li>
            <li><strong>A</strong> should become <code>42</code> after the first step.</li>
          </ul>
        </div>
      </aside>
    </div>
  </section>
    </main>

    <script type="module" src="./main.js"></script>
  </body>
</html>
